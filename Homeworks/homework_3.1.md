# Домашнее задание к занятию "3.1. Работа в терминале. Лекция 1"

### Цель задания

В результате выполнения этого задания вы:
1. Научитесь работать с базовым функционалом инструмента VirtualBox, который помогает с быстрой разверткой виртуальных машин.
2. Научитесь работать с документацией в формате man, чтобы ориентироваться в этом полезном и мощном инструменте документации.
3. Ознакомитесь с функциями Bash (PATH, HISTORY, batch/at), которые помогут комфортно работать с оболочкой командной строки (шеллом) и понять некоторые его ограничения.


### Инструкция к заданию

1. Установите средство виртуализации [Oracle VirtualBox](https://www.virtualbox.org/).

1. Установите средство автоматизации [Hashicorp Vagrant](https://hashicorp-releases.yandexcloud.net/vagrant/).

1. В вашем основном окружении подготовьте удобный для дальнейшей работы терминал. Можно предложить:

	* iTerm2 в Mac OS X
	* Windows Terminal в Windows
	* выбрать цветовую схему, размер окна, шрифтов и т.д.
	* почитать о кастомизации PS1/применить при желании.

	Несколько популярных проблем:
	* Добавьте Vagrant в правила исключения перехватывающих трафик для анализа антивирусов, таких как Kaspersky, если у вас возникают связанные с SSL/TLS ошибки,
	* MobaXterm может конфликтовать с Vagrant в Windows,
	* Vagrant плохо работает с директориями с кириллицей (может быть вашей домашней директорией), тогда можно либо изменить [VAGRANT_HOME](https://www.vagrantup.com/docs/other/environmental-variables#vagrant_home), либо создать в системе профиль пользователя с английским именем,
	* VirtualBox конфликтует с Windows Hyper-V и его необходимо [отключить](https://www.vagrantup.com/docs/installation#windows-virtualbox-and-hyper-v),
	* [WSL2](https://docs.microsoft.com/ru-ru/windows/wsl/wsl2-faq#does-wsl-2-use-hyper-v-will-it-be-available-on-windows-10-home) использует Hyper-V, поэтому с ним VirtualBox также несовместим,
	* аппаратная виртуализация (Intel VT-x, AMD-V) должна быть активна в BIOS,
	* в Linux при установке [VirtualBox](https://www.virtualbox.org/wiki/Linux_Downloads) может дополнительно потребоваться пакет `linux-headers-generic` (debian-based) / `kernel-devel` (rhel-based).


### Инструменты/ дополнительные материалы, которые пригодятся для выполнения задания

1. [Конфигурация VirtualBox через Vagrant](https://www.vagrantup.com/docs/providers/virtualbox/configuration.html)
2. [Использование условий в Bash](https://www.gnu.org/software/bash/manual/html_node/Bash-Conditional-Expressions.html)

------

## Задание

1. С помощью базового файла конфигурации запустите Ubuntu 20.04 в VirtualBox посредством Vagrant:

	* Создайте директорию, в которой будут храниться конфигурационные файлы Vagrant. В ней выполните `vagrant init`. Замените содержимое Vagrantfile по умолчанию следующим:

		```bash
		Vagrant.configure("2") do |config|
			config.vm.box = "bento/ubuntu-20.04"
		end
		```

	* Выполнение в этой директории `vagrant up` установит провайдер VirtualBox для Vagrant, скачает необходимый образ и запустит виртуальную машину.

	* `vagrant suspend` выключит виртуальную машину с сохранением ее состояния (т.е., при следующем `vagrant up` будут запущены все процессы внутри, которые работали на момент вызова suspend), `vagrant halt` выключит виртуальную машину штатным образом.

1. Ознакомьтесь с графическим интерфейсом VirtualBox, посмотрите как выглядит виртуальная машина, которую создал для вас Vagrant, какие аппаратные ресурсы ей выделены. Какие ресурсы выделены по-умолчанию?

### Ответ
Создана виртуальная машина:  
Имя - VirtualMachine_default_1642939907380_9654  
ОС - Ubuntu (64-bit)  
Выделены ресурсы:  
Оперативная память - 1024 Мб  
Процессоры - 2

3. Ознакомьтесь с возможностями конфигурации VirtualBox через Vagrantfile: [документация](https://www.vagrantup.com/docs/providers/virtualbox/configuration.html). Как добавить оперативной памяти или ресурсов процессора виртуальной машине?

### Ответ
Добавить оперативной памяти или ресурсов процессора виртуальной машине можно выключив ее, затем зайдя в Настройки - Система.  
Либо через Vagrantfile, добавив:  
```
config.vm.provider "virtualbox" do |v|
v.memory = 2048
v.cpus = 4
end
```

4. Команда `vagrant ssh` из директории, в которой содержится Vagrantfile, позволит вам оказаться внутри виртуальной машины без каких-либо дополнительных настроек. Попрактикуйтесь в выполнении обсуждаемых команд в терминале Ubuntu.

5. Ознакомьтесь с разделами `man bash`, почитайте о настройках самого bash:
    * какой переменной можно задать длину журнала `history`, и на какой строчке manual это описывается?
    * что делает директива `ignoreboth` в bash?

### Ответ
За длину журнала `history` отвечает переменная `HISTSIZE`, описано на 862 строке мануала.  
Значение `ignoreboth` является сокращением для `ignorespace` (строки, начинающиеся с пробела, не сохраняются в списке истории) и `ignoredups` (строки, соответствующие предыдущей записи истории, не сохраняются).

6. В каких сценариях использования применимы скобки `{}` и на какой строчке `man bash` это описано?

### Ответ
Фигурные скобки являются одними из "зарезервированных слов" (строка 175 мануала). "Зарезервированными" являются слова, имеющие специальное значение для командного интерпретатора.  
С фигурными скобками связан механизм "Brace Expansion" (строка 1091 мануала). Это механизм генерации произвольных строк. Он аналогичен подстановке имен файлов, но генерируемые имена не обязательно должны существовать. Шаблоны в фигурных скобках имеют вид опционального префикса, за которым идет набор строк через запятую в фигурных скобках, после чего - опциональный суффикс. Префикс добавляется в начало каждой строки, содержащейся в фигурных скобках, а затем к каждой полученной таким образом строке добавляется суффикс, в порядке слева направо.  
Выражения в фигурных скобках могут быть вложенными. Результаты каждой замены не сортируются; порядок слева направо сохраняется. Например, конструкция `a{d,c,b}e` заменяется на `ade ace abe`.

7. С учётом ответа на предыдущий вопрос, как создать однократным вызовом `touch` 100000 файлов? Получится ли аналогичным образом создать 300000? Если нет, то почему?

### Ответ
Создать 100000 файлов можно однократным вызовом: `touch {1..100000}.txt`. 300000 файлов аналогично создать не удается, выдает следующее:
`-bash: /usr/bin/touch: Argument list too long` (список слишком длинный).

8. В man bash поищите по `/\[\[`. Что делает конструкция `[[ -d /tmp ]]`

### Ответ
`[[` также является одним из "зарезервированных слов".  
`[[ выражение ]]` является одной из "составных команд". Она возвращает статус 0 или 1 в зависимости от значения указанного условного выражения. Выражения состоят из компонентов, описанных в разделе "Условные выражения".  
"Условные выражения" используются составной командой `[[` и встроенными командами `test` и `[` для проверки атрибутов файла и выполнения строковых и арифметических сравнений.  
Выражение "-d файл" - Истинно, если файл существует и является каталогом.  
Таким образом, конструкция `[[ -d /tmp ]]` проверяет, существует ли директория /tmp (и т.к. она существует, вернет значение true, т.е. 0). Чтобы вернуть статус, необходимо ввести команду `echo $?`.

9. Сделайте так, чтобы в выводе команды `type -a bash` первым стояла запись с нестандартным путем, например bash is ... 
Используйте знания о просмотре существующих и создании новых переменных окружения, обратите внимание на переменную окружения PATH 

    ```bash
    bash is /tmp/new_path_directory/bash
    bash is /usr/local/bin/bash
    bash is /bin/bash
    ```

    (прочие строки могут отличаться содержимым и порядком)
    В качестве ответа приведите команды, которые позволили вам добиться указанного вывода или соответствующие скриншоты.

### Ответ
Указанного вывода удалось добиться с помощью команд:
```
mkdir /tmp/new_path_directory
cp /bin/bash /tmp/new_path_directory/
PATH=/tmp/new_path_directory/:$PATH
type -a bash
```

10. Чем отличается планирование команд с помощью `batch` и `at`?

### Ответ
`batch` и `at` используются для планирования команд.  
`at` позволяет планировать команды в указанное время.  
`batch` выполняет команды, когда позволяют уровни загрузки системы - когда среднее значение загрузки ниже 1,5 или значения, указанного при вызове `atd`; если средняя загрузка системы выше указанной, задания будут ждать в очереди.  
Подробнее - в `man at` или `man batch`.

11. Завершите работу виртуальной машины чтобы не расходовать ресурсы компьютера и/или батарею ноутбука.

*В качестве решения дайте ответы на вопросы свободной форме* 

---

### Правила приема домашнего задания

- В личном кабинете отправлена ссылка на .md файл в вашем репозитории.

### Критерии оценки

Зачет - выполнены все задания, ответы даны в развернутой форме, приложены соответствующие скриншоты и файлы проекта, в выполненных заданиях нет противоречий и нарушения логики.

На доработку - задание выполнено частично или не выполнено, в логике выполнения заданий есть противоречия, существенные недостатки. 